<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZeroTask - –†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- KaTeX –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–æ—Ä–º—É–ª -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            .container {
                max-width: 100%;
                padding: 0 10px;
            }
            
            .header h1 {
                font-size: 24px;
                margin-bottom: 10px;
            }
            
            .header p {
                font-size: 16px;
            }
            
            .task-form, .task-result {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .btn {
                padding: 15px 20px;
                font-size: 18px;
                margin-bottom: 10px;
            }
            
            .nav-buttons {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .nav-buttons .btn {
                width: 100%;
            }
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* WebApp —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .webapp-container {
            background: var(--tg-theme-bg-color, #ffffff);
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∑–æ–Ω—ã */
        @supports (padding: max(0px)) {
            .webapp-container {
                padding-left: max(env(safe-area-inset-left), 20px);
                padding-right: max(env(safe-area-inset-right), 20px);
                padding-top: max(env(safe-area-inset-top), 20px);
                padding-bottom: max(env(safe-area-inset-bottom), 20px);
            }
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .task-form {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--tg-theme-hint-color, #ccc);
            border-radius: 8px;
            font-size: 16px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
            box-sizing: border-box;
        }
        .btn {
            background: var(--tg-theme-button-color, #0088cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn:hover {
            opacity: 0.8;
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .task-result {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
        }
        .loading {
            text-align: center;
            padding: 40px 20px;
        }
        .spinner {
            border: 4px solid var(--tg-theme-hint-color, #f3f3f3);
            border-top: 4px solid var(--tg-theme-button-color, #0088cc);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .user-info {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .nav-buttons .btn {
            flex: 1;
            min-width: 120px;
        }
        .image-preview {
            margin: 10px 0;
            text-align: center;
        }
        .image-preview img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid var(--tg-theme-hint-color, #ccc);
        }
        .remove-image {
            background: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            margin-top: 5px;
            cursor: pointer;
        }
        .screen {
            display: none;
        }
        .screen.active {
            display: block;
        }
        .task-list {
            margin-top: 20px;
        }
        .task-item {
            background: var(--tg-theme-secondary-bg-color, #f5f5f5);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .task-item:hover {
            background: var(--tg-theme-hint-color, #e0e0e0);
        }
        .task-item h4 {
            margin: 0 0 10px 0;
            color: var(--tg-theme-text-color, #000000);
        }
        .task-item p {
            margin: 0;
            color: var(--tg-theme-hint-color, #666);
            font-size: 14px;
        }
        .back-btn {
            background: var(--tg-theme-hint-color, #6c757d);
            margin-bottom: 20px;
        }
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            .header h1 {
                font-size: 20px;
            }
            .header p {
                font-size: 14px;
            }
            .task-form, .task-result {
                padding: 12px;
            }
            .btn {
                padding: 16px 20px;
                font-size: 16px;
            }
            .user-info {
                font-size: 12px;
                padding: 12px;
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è KaTeX */
        .katex {
            font-size: 1.1em;
        }
        
        .katex-display {
            margin: 1em 0;
            text-align: center;
        }
        
        .solution-content, .description-content {
            line-height: 1.6;
            font-size: 16px;
            color: var(--tg-theme-text-color, #000000);
        }
        
        .solution-content p, .description-content p {
            margin: 10px 0;
        }
        
        .solution-content ol, .solution-content ul, .description-content ol, .description-content ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .solution-content li, .description-content li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="webapp-container">
        <div class="container">
            <!-- –ì–ª–∞–≤–Ω—ã–π —ç–∫—Ä–∞–Ω -->
            <div id="mainScreen" class="screen active">
                <div class="header">
                    <h1>üéØ ZeroTask</h1>
                    <p>–†–µ—à–µ–Ω–∏–µ –∑–∞–¥–∞—á —Å –ø–æ–º–æ—â—å—é –ò–ò</p>
                </div>
                
                <div class="user-info">
                    <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <span id="userName">–ó–∞–≥—Ä—É–∑–∫–∞...</span><br>
                    <strong>–ü–æ–¥–ø–∏—Å–∫–∞:</strong> <span id="userSubscription">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn" onclick="showTaskForm()">üìù –†–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É</button>
                    <button class="btn" onclick="showResults()">üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏</button>
                    <button class="btn" onclick="showSubscription()">üí≥ –ü–æ–¥–ø–∏—Å–∫–∞</button>
                    <button class="btn" onclick="showChannel()">üì¢ –ö–∞–Ω–∞–ª</button>
                    <button class="btn" onclick="showSupport()">üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞</button>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —Ñ–æ—Ä–º—ã –∑–∞–¥–∞—á–∏ -->
            <div id="taskFormScreen" class="screen">
                <button class="btn back-btn" onclick="showMainScreen()">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="header">
                    <h2>üìù –†–µ—à–∏—Ç—å –∑–∞–¥–∞—á—É</h2>
                    <p>–û–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ</p>
                </div>
                
                <form id="taskForm" class="task-form">
                    <div class="form-group">
                        <label for="taskDescription">–û–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:</label>
                        <textarea id="taskDescription" name="description" rows="4" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –∑–∞–¥–∞—á—É –ø–æ–¥—Ä–æ–±–Ω–æ..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="taskImage">–§–æ—Ç–æ –∑–∞–¥–∞—á–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                        <input type="file" id="taskImage" name="image" accept="image/*" onchange="previewImage(this)">
                        <div id="imagePreview" class="image-preview" style="display: none;">
                            <img id="previewImg" src="" alt="–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä">
                            <br>
                            <button type="button" class="remove-image" onclick="removeImage()">–£–¥–∞–ª–∏—Ç—å —Ñ–æ—Ç–æ</button>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn" style="width: 100%;">üöÄ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É</button>
                </form>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
            <div id="resultsScreen" class="screen">
                <button class="btn back-btn" onclick="showMainScreen()">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="header">
                    <h2>üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏</h2>
                    <p>–ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –∑–∞–¥–∞—á –∏ —Ä–µ—à–µ–Ω–∏–π</p>
                </div>
                
                <div id="taskList" class="task-list">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—à–∏ –∑–∞–¥–∞—á–∏...</p>
                    </div>
                </div>
            </div>
            
            <!-- –≠–∫—Ä–∞–Ω —Ä–µ—à–µ–Ω–∏—è -->
            <div id="solutionScreen" class="screen">
                <button class="btn back-btn" onclick="showMainScreen()">‚Üê –ù–∞–∑–∞–¥</button>
                <div class="header">
                    <h2 id="solutionHeader">ü§ñ –ë–æ—Ç ZeroTask —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É</h2>
                    <p id="solutionSubheader">–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à—É –∑–∞–¥–∞—á—É...</p>
                </div>
                
                <div id="taskResult" class="task-result">
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>–ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ—à–µ–Ω–∏–µ...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
        const API_BASE_URL = 'https://ef34bb5dea18.ngrok.app';
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        let tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        async function loadUserInfo() {
            try {
                const user = tg.initDataUnsafe?.user;
                if (user) {
                    document.getElementById('userName').textContent = `${user.first_name} ${user.last_name || ''}`.trim();
                    document.getElementById('userSubscription').textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...';
                    
                    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ API
                    // –ü–æ–∫–∞ —á—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
                    document.getElementById('userSubscription').textContent = '–ë–∞–∑–æ–≤—ã–π –∞–∫–∫–∞—É–Ω—Ç';
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', error);
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            document.getElementById(screenId).classList.add('active');
        }
        
        function showMainScreen() {
            showScreen('mainScreen');
        }
        
        function showTaskForm() {
            showScreen('taskFormScreen');
            document.getElementById('taskForm').reset();
            document.getElementById('imagePreview').style.display = 'none';
        }
        
        function showResults() {
            showScreen('resultsScreen');
            loadUserTasks();
        }
        
        function showSolution() {
            showScreen('solutionScreen');
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –∑–∞–¥–∞—á–∏
        document.getElementById('taskForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const description = document.getElementById('taskDescription').value.trim();
            const imageFile = document.getElementById('taskImage').files[0];
            
            if (!description && !imageFile) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–ø–∏—à–∏—Ç–µ –∑–∞–¥–∞—á—É –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–æ—Ç–æ');
                return;
            }
            
            await solveTask(description, imageFile);
        });
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á–∏
        async function solveTask(description, imageFile) {
            try {
                showSolution();
                
                const formData = new FormData();
                formData.append('description', description);
                if (imageFile) {
                    formData.append('image', imageFile);
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
                const taskResult = document.getElementById('taskResult');
                if (imageFile) {
                    taskResult.innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            <h3>üì∏ –ó–∞–≥—Ä—É–∂–∞—é —Ñ–æ—Ç–æ –∏ –∏–∑–≤–ª–µ–∫–∞—é —Ç–µ–∫—Å—Ç...</h3>
                            <p>–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—à–µ–Ω–∏–µ</p>
                        </div>
                    `;
                } else {
                    taskResult.innerHTML = `
                        <div class="loading">
                            <div class="spinner"></div>
                            <h3>ü§î –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—é –∑–∞–¥–∞—á—É...</h3>
                            <p>–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ä–µ—à–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –ò–ò</p>
                        </div>
                    `;
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch(`${API_BASE_URL}/api/tasks/create/`, {
                    method: 'POST',
                    body: formData
                });
                
                if (response.ok) {
                    const result = await response.json();
                    taskResult.innerHTML = `
                        <div class="success">
                            <h3>üìù –ó–∞–¥–∞—á–∞ –ø–æ–ª—É—á–µ–Ω–∞!</h3>
                            <p>‚è≥ –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à—É –∑–∞–¥–∞—á—É...</p>
                        </div>
                    `;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–¥–∞—á–∏:', error);
                document.getElementById('taskResult').innerHTML = `
                    <div class="error">
                        <h3>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–¥–∞—á–∏</h3>
                        <p>${error.message}</p>
                        <button class="btn" onclick="showTaskForm()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    </div>
                `;
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserTasks() {
            try {
                const user = tg.initDataUnsafe?.user;
                if (!user) {
                    document.getElementById('taskList').innerHTML = '<p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</p>';
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/users/${user.id}/tasks/`);
                if (response.ok) {
                    const tasks = await response.json();
                    displayTasks(tasks);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á:', error);
                document.getElementById('taskList').innerHTML = `
                    <div class="error">
                        <p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–¥–∞—á: ${error.message}</p>
                        <button class="btn" onclick="loadUserTasks()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    </div>
                `;
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞—á
        function displayTasks(tasks) {
            const taskList = document.getElementById('taskList');
            
            if (!tasks || tasks.length === 0) {
                taskList.innerHTML = '<p>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞–¥–∞—á</p>';
                return;
            }
            
            const tasksHtml = tasks.map(task => `
                <div class="task-item" onclick="loadTaskSolution(${task.id})">
                    <h4>–ó–∞–¥–∞—á–∞ #${task.id}</h4>
                    <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${task.description || '–§–æ—Ç–æ –∑–∞–¥–∞—á–∞'}</p>
                    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${task.status}</p>
                    <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${new Date(task.created_at).toLocaleString()}</p>
                </div>
            `).join('');
            
            taskList.innerHTML = tasksHtml;
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
        async function loadTaskSolution(taskId) {
            try {
                showSolution();
                
                const response = await fetch(`${API_BASE_URL}/api/tasks/${taskId}/`);
                if (response.ok) {
                    const task = await response.json();
                    displayTaskSolution(task);
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—à–µ–Ω–∏—è:', error);
                document.getElementById('taskResult').innerHTML = `
                    <div class="error">
                        <h3>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ—à–µ–Ω–∏—è</h3>
                        <p>${error.message}</p>
                        <button class="btn" onclick="showResults()">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É</button>
                    </div>
                `;
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ LaTeX —Ñ–æ—Ä–º—É–ª
        function renderMathFormulas(element) {
            if (typeof renderMathInElement === 'function') {
                renderMathInElement(element, {
                    delimiters: [
                        {left: '$$', right: '$$', display: true},
                        {left: '$', right: '$', display: false},
                        {left: '\\(', right: '\\)', display: false},
                        {left: '\\[', right: '\\]', display: true}
                    ],
                    throwOnError: false
                });
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
        function displayTaskSolution(task) {
            const taskResult = document.getElementById('taskResult');
            
            if (task.status === 'processing') {
                displayProcessingStatus(task);
                // –ü–æ–≤—Ç–æ—Ä—è–µ–º –ø–æ–ø—ã—Ç–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => loadTaskSolution(task.id), 3000);
                return;
            }
            
            if (task.status === 'completed' && task.solution) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≥–æ—Ç–æ–≤–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è
                document.getElementById('solutionHeader').textContent = '‚úÖ –†–µ—à–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ';
                document.getElementById('solutionSubheader').textContent = '–í–∞—à–∞ –∑–∞–¥–∞—á–∞ —Ä–µ—à–µ–Ω–∞!';
                
                taskResult.innerHTML = `
                    <div class="success">
                        <div class="solution-content">
                            ${task.solution}
                        </div>
                        <div class="task-info">
                            <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></p>
                            <div class="description-content">
                                ${task.description || '–§–æ—Ç–æ –∑–∞–¥–∞—á–∞'}
                            </div>
                            <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${new Date(task.created_at).toLocaleString()}</p>
                        </div>
                    </div>
                `;
                
                // –†–µ–Ω–¥–µ—Ä–∏–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                setTimeout(() => {
                    const solutionContent = taskResult.querySelector('.solution-content');
                    if (solutionContent) {
                        renderMathFormulas(solutionContent);
                    }
                    
                    const descriptionContent = taskResult.querySelector('.description-content');
                    if (descriptionContent) {
                        renderMathFormulas(descriptionContent);
                    }
                }, 100);
            } else if (task.status === 'failed') {
                taskResult.innerHTML = `
                    <div class="error">
                        <h3>‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏</h3>
                        <p>${task.error_message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</p>
                        <button class="btn" onclick="showTaskForm()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                    </div>
                `;
            } else {
                // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
                document.getElementById('solutionHeader').textContent = 'ü§ñ –ë–æ—Ç ZeroTask —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É';
                document.getElementById('solutionSubheader').textContent = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à—É –∑–∞–¥–∞—á—É...';
                
                taskResult.innerHTML = `
                    <div class="info">
                        <p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong></p>
                        <div class="description-content">
                            ${task.description || '–§–æ—Ç–æ –∑–∞–¥–∞—á–∞'}
                        </div>
                        <p><strong>–°–æ–∑–¥–∞–Ω–∞:</strong> ${new Date(task.created_at).toLocaleString()}</p>
                    </div>
                `;
                
                // –†–µ–Ω–¥–µ—Ä–∏–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã –≤ –æ–ø–∏—Å–∞–Ω–∏–∏
                setTimeout(() => {
                    const descriptionContent = taskResult.querySelector('.description-content');
                    if (descriptionContent) {
                        renderMathFormulas(descriptionContent);
                    }
                }, 100);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        function displayProcessingStatus(task) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('solutionHeader').textContent = 'ü§ñ –ë–æ—Ç ZeroTask —Ä–µ—à–∞–µ—Ç –∑–∞–¥–∞—á—É';
            document.getElementById('solutionSubheader').textContent = '–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤–∞—à—É –∑–∞–¥–∞—á—É...';
            
            const taskResult = document.getElementById('taskResult');
            taskResult.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–¥–∞—á–∞ —Ä–µ—à–∞–µ—Ç—Å—è...</p>
                </div>
            `;
        }
        
        // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function previewImage(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('previewImg').src = e.target.result;
                    document.getElementById('imagePreview').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }
        
        // –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function removeImage() {
            document.getElementById('taskImage').value = '';
            document.getElementById('imagePreview').style.display = 'none';
        }
        
        // –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
        function showSubscription() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–∑–∂–µ');
        }
        
        function showChannel() {
            alert('–°—Å—ã–ª–∫–∞ –Ω–∞ –∫–∞–Ω–∞–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–∑–∂–µ');
        }
        
        function showSupport() {
            alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ–∑–∂–µ');
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º task_id –≤ URL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const taskId = urlParams.get('task_id');
            
            if (taskId) {
                showSolution();
                loadTaskSolution(taskId);
            }
            
            loadUserInfo();
        });
    </script>
</body>
</html>
